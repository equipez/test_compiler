!        This is file : test_index
! Author= zaikunzhang
! Started at: 14.06.2022
! Last Modified: Tuesday, June 14, 2022 PM02:51:07

! Absoft 64-bit Pro Fortran 22.0.2 on Ubuntu 20.04 raises the following errors
!
! $ af95 test_index.f90 && ./a.out
!   3  4  5  2  4
!   1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000 -1.00000000000000  1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000
!   4  3184652083503114539  2  3184370608526404667  2
! Erreur de segmentation (core dumped)
!
! $ af95 -Rc test_index.f90 && ./a.out  # The result of the second printed line is wrong.
!   3  4  5  2  4
!   0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000  1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  0.000000000000000  1.00000000000000
!   4  3184652083503114539  2  3184370608526404667  2
! Erreur de segmentation (core dumped)


program test_index
use, intrinsic :: iso_fortran_env, only : INT64
implicit none
real(kind(0.0D0)), parameter :: a(56) = [0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&1.00000000000000, &
&-1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&-1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&-1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&-1.00000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000, &
&0.000000000000000]

real(kind(0.0D0)) :: b(4, 14) = reshape(a, [4, 14])
integer(INT64), parameter :: k(10) = [1, 2, 2, 3, 3, 4, 4, 1, 1, 3]
integer(INT64) :: ij1(2, 5) = reshape(k, [2, 5])
integer(INT64) :: ij2(2, 5)

ij2(1, :) = [1, 2, 3, 4, 1]
ij2(2, :) = [2, 3, 4, 1, 3]

write (*, *) ij2(2, :) + 1
write (*, *) b(:, ij2(1, :) + 1)  ! The result of this line is wrong

write (*, *) ij1(2, :) + 1  ! The result of this line is wrong
write (*, *) b(:, ij1(1, :) + 1)  ! This line causes a SEGFAULT due to the result of last line

end program test_index
